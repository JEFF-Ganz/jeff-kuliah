function updateClock() {
  const e = new Date(),
    t = String(e.getHours()).padStart(2, "0"),
    r = String(e.getMinutes()).padStart(2, "0"),
    a = String(e.getSeconds()).padStart(2, "0"),
    o = `${t}:${r}:${a}`,
    n = {
      Monday: "Senin",
      Tuesday: "Selasa",
      Wednesday: "Rabu",
      Thursday: "Kamis",
      Friday: "Jumat",
      Saturday: "Sabtu",
      Sunday: "Minggu",
    },
    l =
      n[
        [
          "Sunday",
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday",
          "Saturday",
        ][e.getDay()]
      ],
    c = e.toLocaleDateString("id-ID", {
      weekday: "long",
      year: "numeric",
      month: "long",
      day: "numeric",
    }),
    s = document.getElementById("clock"),
    i = document.getElementById("date");
  (s && (s.textContent = o), i && (i.textContent = c));
}
function checkReminders() {
  const e = new Date(),
    t = String(e.getHours()).padStart(2, "0"),
    r = String(e.getMinutes()).padStart(2, "0"),
    a = `${t}:${r}`,
    o = {
      Sunday: "Minggu",
      Monday: "Senin",
      Tuesday: "Selasa",
      Wednesday: "Rabu",
      Thursday: "Kamis",
      Friday: "Jumat",
      Saturday: "Sabtu",
    },
    n =
      o[
        [
          "Sunday",
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday",
          "Saturday",
        ][e.getDay()]
      ];
  document.querySelectorAll(".schedule-card").forEach((o) => {
    const l = o.querySelector(".time-badge");
    if (!l) return;
    const c = l.textContent.trim(),
      s = o.querySelector(".schedule-info h4");
    if (!s) return;
    const i = s.textContent.trim(),
      [d, u] = c.split(":"),
      m = new Date();
    m.setHours(parseInt(d), parseInt(u), 0);
    const h = new Date(m.getTime() - 15 * 60 * 1e3),
      y =
        String(h.getHours()).padStart(2, "0") +
        ":" +
        String(h.getMinutes()).padStart(2, "0");
    a === y && showReminder(i);
  });
}
function showReminder(e) {
  const t = document.getElementById("reminder-notification");
  t &&
    ((t.innerHTML = `<strong>ğŸ”” PENGINGAT!</strong><br>Mata Kuliah <strong>${escapeHtml(e)}</strong> akan dimulai 15 menit lagi!<br>Segera persiapkan dirimu! ğŸ“š`),
    (t.style.display = "block"),
    (function () {
      try {
        const e = new (window.AudioContext || window.webkitAudioContext)(),
          t = e.createOscillator(),
          r = e.createGain();
        (t.connect(r),
          r.connect(e.destination),
          (t.frequency.value = 800),
          (t.type = "sine"),
          r.gain.setValueAtTime(0.3, e.currentTime),
          r.gain.exponentialRampToValueAtTime(0.01, e.currentTime + 0.5),
          t.start(e.currentTime),
          t.stop(e.currentTime + 0.5));
      } catch (e) {
        console.log("Audio notification tidak didukung");
      }
    })(),
    "Notification" in window &&
      "granted" === Notification.permission &&
      new Notification("Pengingat Akademik", {
        body: `Mata Kuliah ${e} akan dimulai 15 menit lagi!`,
        icon: "ğŸ“š",
      }),
    setTimeout(() => {
      t.style.display = "none";
    }, 1e4));
}
function escapeHtml(e) {
  const t = document.createElement("div");
  return ((t.textContent = e), t.innerHTML);
}
(setInterval(updateClock, 1e3),
  updateClock(),
  setInterval(checkReminders, 6e4),
  "Notification" in window &&
    "default" === Notification.permission &&
    Notification.requestPermission(),
  document.querySelectorAll('a[href^="#"]').forEach((e) => {
    e.addEventListener("click", function (e) {
      e.preventDefault();
      const t = document.querySelector(this.getAttribute("href"));
      t && t.scrollIntoView({ behavior: "smooth", block: "start" });
    });
  }),
  document.querySelectorAll("form").forEach((e) => {
    e.addEventListener("submit", function (e) {
      let t = !0;
      (this.querySelectorAll("[required]").forEach((e) => {
        e.value.trim()
          ? (e.style.borderColor = "")
          : ((e.style.borderColor = "var(--danger)"), (t = !1));
      }),
        t ||
          (e.preventDefault() &&
            alert("âš ï¸ Mohon isi semua field yang wajib diisi!")));
    });
  }),
  document.querySelectorAll('input[type="file"]').forEach((e) => {
    e.addEventListener("change", function (e) {
      const t = e.target.files[0];
      t &&
        t.size > 2097152 &&
        (alert("âŒ Ukuran file terlalu besar! Maximum 20MB"),
        (this.value = ""));
    });
  }),
  document.querySelectorAll(".btn-delete").forEach((e) => {
    e.addEventListener("click", function (e) {
      confirm(
        "ğŸ—‘ï¸ Yakin ingin menghapus? Tindakan ini tidak bisa dibatalkan!",
      ) || e.preventDefault();
    });
  }),
  console.log("âœ… Student Academic Planner - Optimized!"));
